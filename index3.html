<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        .button {
            background-color: gray;            
            border: none;
            color: white;
            padding: 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 10px;
            margin: 6px 30px 2px;
            cursor: pointer;
        }

        .button_white {
            background-color: white;            
            border: none;
            color: white;
            padding: 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 10px;
            margin: 5px 31px 3px;
            cursor: pointer;
        }

        .button1 {
            border-radius: 2px;
        }

        .button2 {
            border-radius: 4px;
        }

        .button3 {
            border-radius: 8px;
        }

        .button4 {
            border-radius: 12px;
        }

        .button5 {
            border-radius: 50%;
            /*padding: 20px;*/
        }

        * {
            cursor: pointer;
        }

        body {
            background-image: url("violao3.png");
            background-repeat: no-repeat;
            
        }

        /*#conteudo {*/
        /*background-image: url("violao3.png");
            background-repeat: no-repeat;
            */
        /*}*/
    </style>
    <script>
        // localStorage.setItem("shapes", JSON.stringify([]));
        if (localStorage.getItem("shapes") == null) {
            localStorage.setItem("shapes", JSON.stringify([]));
        }

        function importar(){
            try {
                var shapes = JSON.parse(document.getElementById("importar").value);                
                if (shapes.length > 0) {
                    localStorage.setItem("shapes", JSON.stringify(shapes));
                    alert("Importação realizada!");
                    document.getElementById("importar").value =  "";
                } else {
                    alert("erro na importação");
                }
            } catch(e) {
                alert("erro na importação");
            }            
        }

        function exportar(){
            document.getElementById("exportar").innerHTML = "";
            if (document.getElementById("btn_exportar").innerHTML == 'Exportar') {
                document.getElementById("exportar").innerHTML = localStorage.getItem("shapes");
                document.getElementById("btn_exportar").innerHTML = 'Limpar Exportar';
            } else {
                document.getElementById("btn_exportar").innerHTML = 'Exportar';
            } 
        }

        function editar(i){
            var vetBotao = document.querySelectorAll("button");

            var shapes = JSON.parse(localStorage.getItem("shapes"));
            var s = shapes[i];
            alert("O shape "+s.nome+" receberá a configuração que está em exibição");
            s.nome = prompt("Novo nome para "+s.nome+"?", s.nome);
            if (s.nome != ""){
                var shapeNovo = []
                for (let index = 0; index < vetBotao.length; index++) {
                    if (/*vetBotao[index].innerHTML == "--" ||*/ vetBotao[index].innerHTML == "1" || vetBotao[index].innerHTML == "2" || vetBotao[index].innerHTML == "3" || vetBotao[index].innerHTML == "4") {
                        shapeNovo.push({ "botao": vetBotao[index].id, "dedo": vetBotao[index].innerHTML, "tonica": vetBotao[index].style.backgroundColor})
                    }
                }
                s.shape = shapeNovo;
                shapes[i] = s;
                localStorage.setItem("shapes", JSON.stringify(shapes));
                listar_shapes();
            } else {
                alert("nome não pode estar em branco");
            }
        }

        function deletar(i){            
            var shapes = JSON.parse(localStorage.getItem("shapes"));
            shapes.splice(i, 1);
            localStorage.setItem("shapes", JSON.stringify(shapes));
            listar_shapes();
        }

        function duplicar(i){
            // reiniciar();
            var shapeDuplicado = JSON.parse(localStorage.getItem("shapes"))[i];         
            var shapes = JSON.parse(localStorage.getItem("shapes"));
            shapes.push({ "nome": prompt("novo nome", shapeDuplicado.nome+"_duplicado"), "shape": shapeDuplicado.shape});
            localStorage.setItem("shapes", JSON.stringify(shapes));               
            listar_shapes();
        }

        function restaurar(i){
            reiniciar();
            var s = JSON.parse(localStorage.getItem("shapes"))[i];                        
            for (let index = 0; index < s.shape.length; index++) {         
                document.getElementById(s.shape[index].botao).innerHTML = s.shape[index].dedo;
                document.getElementById(s.shape[index].botao).style.backgroundColor = s.shape[index].tonica;                
            }
        }

        function listar_shapes() {
            document.getElementById("lista_shapes").innerHTML = "";
            var shapes = JSON.parse(localStorage.getItem("shapes"));
            for (let index = 0; index < shapes.length; index++) {
                var s = shapes[index];
                document.getElementById("lista_shapes").innerHTML += s.nome + "<br>";
                for (let index1 = 0; index1 < s.shape.length; index1++) {
                    var b = s.shape[index1];
                    document.getElementById("lista_shapes").innerHTML += "*" + b.botao + ";" + b.dedo + "<br>";
                }
                document.getElementById("lista_shapes").innerHTML += "<button onclick='restaurar("+index+")'>Restaurar</button>";
                document.getElementById("lista_shapes").innerHTML += "<button onclick='duplicar("+index+")'>Duplicar</button>";
                document.getElementById("lista_shapes").innerHTML += "<button onclick='deletar("+index+")'>Deletar</button>";
                document.getElementById("lista_shapes").innerHTML += "<button onclick='editar("+index+")'>Editar</button>";
                document.getElementById("lista_shapes").innerHTML += "<hr>";
            }
        }

        function salvar() {
            var nome = prompt("Nome?", "teste");
            var vetBotao = document.querySelectorAll("button");
            var shapeNovo = []
            for (let index = 0; index < vetBotao.length; index++) {
                if (/*vetBotao[index].innerHTML == "--" ||*/ vetBotao[index].innerHTML == "1" || vetBotao[index].innerHTML == "2" || vetBotao[index].innerHTML == "3" || vetBotao[index].innerHTML == "4") {
                    shapeNovo.push({ "botao": vetBotao[index].id, "dedo": vetBotao[index].innerHTML, "tonica": vetBotao[index].style.backgroundColor})
                }
            }
            if (shapeNovo.length > 0) {
                var shapes = JSON.parse(localStorage.getItem("shapes"));
                shapes.push({ "nome": nome, "shape": shapeNovo });
                localStorage.setItem("shapes", JSON.stringify(shapes));
                listar_shapes();
            }
        }
        function reiniciar() {
            var vetBotao = document.querySelectorAll("button");
            for (let index = 0; index < vetBotao.length; index++) {
                if (/*vetBotao[index].innerHTML == "--" ||*/ vetBotao[index].innerHTML == "1" || vetBotao[index].innerHTML == "2" || vetBotao[index].innerHTML == "3" || vetBotao[index].innerHTML == "4") {
                    vetBotao[index].innerHTML = "--";
                    vetBotao[index].style.backgroundColor = "gray";
                    vetBotao[index].style.color = "white";
                }
            }
        }
        // bug 
        function limpar_volta() {
            var vetBotao = document.querySelectorAll("button");
            if (document.getElementById("limpa_volta").innerHTML == 'Limpar') {
                for (let index = 0; index < vetBotao.length; index++) {
                    if (vetBotao[index].innerHTML == "--") {                        
                        // vetBotao[index].innerHTML = "";
                        vetBotao[index].style.backgroundColor = "#F7F0D6";
                        vetBotao[index].style.zIndex = -110; 
                    }
                }
                document.getElementById("limpa_volta").innerHTML = "Retornar";
            } else {
                for (let index = 0; index < vetBotao.length; index++) {
                    if (vetBotao[index].innerHTML == "--") {
                        // vetBotao[index].innerHTML = "--";
                        vetBotao[index].style.backgroundColor = "gray";
                        vetBotao[index].style.color = "white";
                    }
                }
                document.getElementById("limpa_volta").innerHTML = "Limpar";
            }
        }
        function define(id) {
            var entrada = prompt("Ex:1,red|2,red|3,black|--,gray", "1,black");
            if (entrada != null && entrada != ""){
                if (entrada.length > 0) {
                    if (entrada.split(",").length == 2) {
                        document.getElementById(id).innerHTML = entrada.split(",")[0];
                        if (entrada.split(",")[1] == 'black' || entrada.split(",")[1] == 'red' || entrada.split(",")[1] == 'gray') {
                            document.getElementById(id).style = "background-color: " + entrada.split(",")[1];
                        } else {
                            alert("Respeite o formato: Ex: 1,red");
                        }
                    } else {
                        alert("Respeite o formato: Ex: 1,red");
                    }
                } else {
                    alert("Respeite o formato: Ex: 1,red");
                }
            }
            // } else {
            //     document.getElementById(id).innerHTML = dedo;
            //     document.getElementById(id).style = "background-color: black";
            // }
            // var conteudo = document.getElementById(id).innerHTML;
            // if (conteudo == "--") {
            //     document.getElementById(id).innerHTML = "1";
            //     document.getElementById(id).style = "background-color: black";
            // }
            // if (conteudo == "1") {
            //     document.getElementById(id).innerHTML = "1";
            //     document.getElementById(id).style = "background-color: red";
            // }
            // if (conteudo == "--") {
            //     document.getElementById(id).innerHTML = "1";
            //     document.getElementById(id).style = "background-color: black";
            // }

        }
        function inicializar() {
            var cordas = 42;
            var aux = 1;
            for (let index = 1; index <= 42; index++) {
                if (aux == 7) {
                    document.querySelector("#conteudo").innerHTML += "<button id=\"" + index + "\" class=\"button button5\" onclick=\"define(" + index + ")\">--</button><br>";
                    aux = 1;
                }
                else {
                    document.querySelector("#conteudo").innerHTML += "<button id=\"" + index + "\" class=\"button button5\" onclick=\"define(" + index + ")\">--</button>";
                    aux++;
                }
            }
        }
    </script>
</head>

<body onload="inicializar()">
    <div style="float: left; width: 10px; height: 400px;"></div>
    <div id="conteudo"></div>
    <br>
    <div id="lista_shapes"> </div> 
    <button id="reiniciar" onclick="reiniciar()">Reiniciar</button>
    <button id="limpa_volta" onclick="limpar_volta()">Limpar</button>
    <button onclick="salvar()">Salvar</button>
    <button onclick="listar_shapes()">Listar</button>
    <button id="btn_exportar" onclick="exportar()">Exportar</button> 
    <button id="btn_importar" onclick="importar()">Importar</button> <textarea id="importar"></textarea>
    <hr>
    <div id="exportar"></div>
</body>
</html>
